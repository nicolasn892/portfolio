<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Turismo em Portugal — Demo</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:1000px;margin:24px auto;padding:12px}
    h1{margin:6px 0 8px}
    #controls{display:flex;gap:10px;align-items:center;margin-bottom:12px}
    select{padding:6px;border-radius:6px}
    .chart{border:1px solid #eee;border-radius:8px;padding:10px;margin-bottom:12px;background:#fff}
  </style>
</head>
<body>
  <h1>Turismo em Portugal — Demo interativa</h1>
  <p>Selecione uma cidade para ver evolução do número de turistas e gasto médio.</p>

  <div id="controls">
    <label for="city">Cidade:</label>
    <select id="city"></select>
  </div>

  <div id="chart1" class="chart"></div>
  <div id="chart2" class="chart"></div>

<script>
async function loadData(){
  const resp = await fetch('data/turismo.csv');
  const text = await resp.text();
  const lines = text.trim().split('\\n');
  const headers = lines[0].split(',');
  const rows = lines.slice(1).map(l => l.split(','));
  const data = rows.map(r => {
    return {
      ano: parseInt(r[0]),
      cidade: r[1],
      turistas_estrangeiros: parseInt(r[2]),
      turistas_nacionais: parseInt(r[3]),
      gasto_medio: parseFloat(r[4])
    };
  });
  return data;
}

function uniq(arr){ return [...new Set(arr)]; }

function plotCity(data, city){
  const cityData = data.filter(d => d.cidade === city).sort((a,b)=>a.ano-b.ano);
  const anos = cityData.map(d=>d.ano);
  const estr = cityData.map(d=>d.turistas_estrangeiros);
  const nat = cityData.map(d=>d.turistas_nacionais);
  const gasto = cityData.map(d=>d.gasto_medio);

  const trace1 = { x: anos, y: estr, name:'Turistas estrangeiros', type:'bar' };
  const trace2 = { x: anos, y: nat, name:'Turistas nacionais', type:'bar' };
  const layout1 = {barmode:'group', title: city + ' — Total de turistas por ano', margin:{t:50}};
  Plotly.newPlot('chart1',[trace1,trace2],layout1,{responsive:true});

  const trace3 = { x: anos, y: gasto, name:'Gasto médio (€)', mode:'lines+markers', yaxis:'y2' };
  const layout2 = { title: city + ' — Gasto médio por ano', margin:{t:50},
    yaxis:{title:'Gasto médio (€)'} };
  Plotly.newPlot('chart2',[trace3],layout2,{responsive:true});
}

(async()=>{
  const data = await loadData();
  const cities = uniq(data.map(d=>d.cidade)).sort();
  const sel = document.getElementById('city');
  cities.forEach(c=>{
    const opt = document.createElement('option');
    opt.value = c; opt.innerText = c;
    sel.appendChild(opt);
  });
  sel.addEventListener('change', ()=>plotCity(data, sel.value));
  // inicial
  plotCity(data, cities[0]);
})();
</script>

</body>
</html>
